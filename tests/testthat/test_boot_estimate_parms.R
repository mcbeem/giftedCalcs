context("boot_estimate_parms()")

# generate some data
set.seed(123)
scores <- c(1.72541161304904, 1.88122856542566, 1.91168832022374, 2.73344615522918,
            2.08353988003014, 1.55665105617572, 2.10267940770372, 1.2913390844976,
            1.73173504936948, 1.31301003646454, 1.46697561728302, 2.27883626480956,
            2.20154763966412, 2.13173370303191, 1.81260779525532, 1.68613935040622,
            1.64752875118091, 1.4846900696409, 1.73694696781548, 1.1889559349645,
            2.47066280809371, 1.26269018001834, 1.63591378828647, 1.9759617004717,
            1.82989768470446, 1.82247506952642, 2.14764057610983, 1.90887265739608,
            1.58438419092409, 1.28928309520679, 2.90705506658474, 1.47717931725113,
            1.48816119512313, 1.21210863303326, 1.77271654824371, 1.84767778891948,
            1.65261284531629, 2.17860996236533, 1.73043350104002, 2.07020401978394,
            1.53363318829222, 2.97817783733706, 1.72254963393141, 1.47655446498124,
            1.97780920273239, 1.66459241632786, 1.35155717824869, 1.64765544233551,
            2.00074996201909, 1.51267364719108, 1.40436964589158, 1.31398201182299,
            1.90565582328921, 1.35370459580551, 1.59048139682599, 1.71198248233429,
            2.80018942502865, 1.96666927709952, 1.88509046712669, 1.80773854566941,
            1.62575075169941, 1.08777964684295, 2.22813532100684, 1.09645798073321,
            2.20835896941402, 1.01476657003886, 1.56957229920105, 1.17774502166324,
            1.32214487280005, 1.78278981034338, 2.13643479721115, 1.30100189889805,
            3.52421413240102, 1.99923381280411, 2.17456440031178, 1.87852594044386,
            2.9476653550348, 1.27673992009356, 2.00558346153247, 1.60716351242722,
            1.29366974918481, 2.49927973961358, 1.72224948444691, 2.41985709619138,
            1.58595509644054, 1.95581740828717, 1.67643686822006, 1.38070891374095,
            1.165426738906, 2.87965688963573, 1.52798147287292, 1.23036895085714,
            2.98412546150605, 1.70729124192049, 1.62997769068136, 1.43603275811353,
            1.53655706704371, 2.48336602544829, 1.57726385726438, 2.71304542922381,
            1.61607773630497, 1.17894453880936, 2.16493415119025, 2.41981970728829,
            1.65624169804299, 1.4730246603278, 1.31840552028597, 1.54703961886165,
            2.06180957109862, 1.43969457702586, 1.75190531185005, 1.14001439140803,
            1.50020385698119, 1.5535235699266, 1.89158658117078, 2.67304613158348,
            1.0503331462698, 1.57464511480891, 1.59083739882844, 3.03297594227916,
            2.6466551321902, 1.77569125173242, 1.64322305609567, 1.89091839506352,
            2.19930338429222, 2.28498010488362, 1.93527440651573, 2.06656895317397,
            2.04473168901582, 1.90591384482805, 2.69498558485716, 2.45015322235454,
            1.54544390409062, 2.88238749128999, 2.49240284456353, 1.47404862028378,
            1.45464350796747, 1.35833523010319, 2.01630948984315, 2.90057197513226,
            2.51896677369333, 2.2368552890304, 0.949890285792147, 1.53298692392154,
            1.662258494634, 2.2092604220766, 1.19245263959638, 1.96772833293791,
            1.15093111559901, 2.18713119684867, 1.57371490623172, 2.19901116452436,
            2.17269421836994, 2.53676277727477, 1.84846852034711, 2.37199481810131,
            1.22883819866191, 1.74064501529253, 2.71063986756566, 1.81775347038307,
            0.936154244326376, 1.54835515080362, 1.33995404014529, 1.62327245927072,
            1.82757125276217, 3.17723344469576, 1.738303639377, 2.18214242810247,
            2.37568163889102, 1.35477509509151, 1.60425020994754, 2.27240680014784,
            1.32815390955847, 1.8372765842255, 1.29797556258101, 2.09142544427684,
            1.6189370609669, 1.50938842231088, 1.41485124250874, 1.5474689097971,
            1.6609650824711, 1.23908964812705, 1.51576098011232, 0.989369147180495,
            1.66344633333101, 1.56547711210696, 2.18321220958261, 2.12213716014445,
            1.9101482786057, 2.5039858726616, 3.08706282390709, 1.74596398294238,
            1.32356493546446, 1.2863658977, 1.2015751899223, 1.5103894258372,
            0.996710701311199, 2.58593252481276, 2.2152998454923, 2.42004199535426,
            1.66411056355898, 2.11338204638389, 1.27840287025227, 1.15913076507013,
            1.7206575593611, 1.73377349958645, 1.92329236716004, 2.73201590423936,
            1.67568133504498, 2.03798366772293, 1.85528841962004, 2.21408927328923,
            2.24829998616157, 2.68774887583606, 1.27985142793855, 1.39226092677799,
            1.14092728451982, 1.93892489832673, 2.13082169352807, 1.3297510959348,
            1.06263298521112, 1.79538486565312, 1.38040604112068, 1.79423350896073,
            1.95123243069705, 1.52525057032378, 1.77638988094876, 2.34593357093641,
            2.31337381491593, 1.84608559101282, 1.23492289923332, 1.16158207478306,
            2.04906817407055, 1.37127618713104, 2.30420861833153, 2.26901166230337,
            1.96445569263711, 2.44214817286833, 1.80550145708803, 2.96474744012969,
            1.76266198793105, 1.80444011097772, 1.95159338145314, 2.27039974920111,
            1.21846959620432, 1.20782387227271, 1.80172122273595, 1.53796926153113,
            1.23859018341636, 0.937278666315783, 1.45116679279978, 3.23599834351355,
            1.87798209618048, 1.5111908661883, 1.82930319169491, 2.13606055581207,
            2.37142302063546, 1.24555893603553, 1.53193779711261, 1.08870757413928,
            1.66284335612238, 2.31688424618566, 1.12465333127349, 1.39590559566705,
            1.76007567634501, 0.88071137086338, 1.91911704895694, 1.27489786962692,
            2.6135928340786, 2.85556430277775, 2.79988070401035, 1.77635250862879,
            2.08169565323906, 1.30672597515165, 2.13594346462462, 1.26615809719788,
            2.0833715377343, 1.48142712223153, 1.31917163776237, 1.99994172924589,
            2.69405579163947, 1.52103671792525, 2.27268820566091, 1.81952239112452,
            2.0008330248798, 1.97961140683055, 3.17930192136521, 2.5938402825393,
            2.67038316905349, 1.63014563311226, 1.82575698415072, 2.1893799882109,
            1.94640303965117, 2.06808841502454, 1.84617077687706, 1.72999842053437,
            1.47118219756785, 2.55366405319629, 0.971040279396887, 1.40702333137705,
            1.50132429906593, 1.70360033774946, 1.21561856148519, 1.96576088524966,
            1.00423556197584, 3.03636520424586, 1.92589504331911, 1.8947420288063,
            1.88084397406833, 0.978704219549732, 1.80450967162545, 1.06805770258691,
            1.27389643973311, 1.67744195271882, 1.26191541778626, 1.68639483786186,
            2.62842175870187, 1.44593975885418, 2.70241128222676, 1.28803143142636,
            2.08025529051156, 1.73415391225614, 2.00700750079131, 1.79806515388894,
            1.71555888221053, 1.30578076696345, 1.83537330638663, 1.77619693256311,
            1.61307417192994, 3.29431307465738, 3.31236468502076, 1.21314809852132,
            1.73522153111991, 1.94162161371584, 1.19076752226389, 1.99268473108921,
            1.75965848399005, 2.56943788344619, 1.96313014415968, 2.06231181489136,
            2.2184310478969, 1.22443284549368, 1.60734346671601, 2.78895827119132,
            1.79860648624112, 1.70952616347506, 1.16405381506546, 1.87358834822714,
            2.01644174887524, 2.08850248447854, 1.3515255803039, 1.4267828052073,
            2.13370978925896, 2.38183520773907, 1.33896058398619, 1.80783252340661,
            2.76663080659951, 1.65194703294838, 1.03018236519749, 1.63132601558567,
            3.01381696598784, 1.98429310098787, 1.4070282399647, 1.63029773651021,
            1.17821079955734, 1.83760905174992, 1.34831345383625, 1.60276563290053,
            1.58772914383825, 1.30393279494327, 2.36938338135945, 2.06695549200953,
            1.594678622398, 1.52653022512322, 1.4745984090294, 2.02258141775656,
            2.02352163369399, 1.36806658537311, 2.76870785020781, 1.10795242482333,
            1.84527286498602, 1.31946384278016, 1.73055803883251, 1.39422852345473,
            1.75847108866108, 2.32500771435663, 1.88673952546142, 0.878239301588051,
            1.292267196922, 1.69246057191169, 2.17849315973191, 1.95792549521694,
            2.6349041488385, 2.1138986342837, 1.34169525004534, 1.36501179260386,
            2.2803379481806, 1.51249275990109, 2.13026029873956, 1.36688960338359,
            2.09338293496802, 1.89955912517885, 1.29039174909843, 2.39080986139475,
            1.64746295048283, 3.02572278536744, 3.2263621166675, 2.1531886346485,
            2.56977735117456, 2.39555854230511, 1.73622335763988, 1.84386418206593,
            1.56945581354266, 1.93163268965218, 1.344413124328, 1.80356856334232,
            2.20857953729459, 1.18569875047556, 2.06293136494185, 1.39477264254356,
            1.80485845907048, 2.20088633700317, 1.41452427442807, 1.34356990947058,
            0.912889324842899, 2.41604565101131, 1.54588390003059, 2.52927556996002,
            2.18787430249695, 2.07341777615438, 2.45811390918453, 1.4448947888641,
            2.22281940766861, 1.84508676373584, 2.992237946797, 1.43725930698128,
            3.02833153254007, 1.27813674350644, 2.30722562001538, 2.37261631979872,
            1.76015648646063, 1.41925127757852, 1.37721898357625, 2.16964096960048,
            1.39137460083584, 2.37557884160259, 1.72122907284297, 1.03740242610367,
            2.42981912563161, 1.69176438007774, 1.70172291164786, 1.66607797322881,
            1.53842265872637, 1.68097063427052, 1.95221579544294, 2.63880047108067,
            2.3572256017616, 1.9571082750637, 1.80521872917824, 2.56741228499725,
            2.6623416767534, 2.16282876012144, 1.78644867263543, 1.83339671705125,
            1.30001926830346, 1.95733704027958, 2.13777320955548, 1.88589647088828,
            2.57439179800275, 1.27157546848744, 1.49561201539819, 2.78558666916986,
            1.63229175472359, 1.57914422129157, 2.31254060341206, 1.74349473694729,
            1.34168813044624, 1.1749903918384, 2.55363520248542, 2.0000635853616,
            2.2352909449144, 1.4978061818121, 1.8920122245381, 2.32442477905491,
            1.2808596911913, 1.36119706042024, 1.39740419008128, 2.10502777109651,
            2.5294486036443, 1.44020771094085, 1.48137687170933, 2.41130384688202,
            2.00069247687638, 1.55527871795052, 1.28742551151321, 1.36462624194238,
            1.70162053720634, 3.02008584140344, 2.14931114717092, 1.87910364813368
)

# estimate the system parameters with 10 bootstrapped samples
a <-boot_estimate_parms(scores, id.rate= 0.03240091, nom.rate=.1, reps=100)
apply(a, 2, mean)

expect_equal(
  apply(a, 2, mean),
  structure(c(0.896912876445702, 0.915123324229081, 0.492618121853775,
              0.9), .Names = c("test.cutoff", "relyt", "valid", "nom.cutoff"
              )),
  tolerance=1e-2)

expect_error(
  boot_estimate_parms(scores, id.rate= 0.03240091, nom.rate=.1, reps=100, multicore="sure"))
