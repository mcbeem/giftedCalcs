context("pbboot()")

m.boot <- function(data, indices) {
   d <- data[indices]
   mean(d, na.rm = T)
}

v1 <- c(-1.52233668167861, 0.194177825383382, 0.841010584412007, -0.376516363000146,
        -0.906071645787287, -0.324164008282606, -0.474794042394624, -1.11661820848964,
        -0.115320893277569, -0.558329611570743, 1.19581689841031, 0.451918408579288,
        -0.371386670644682, 0.294674426963808, 0.403357234889383, -0.481910939310586,
        1.69811536111934, 1.51462782360288, 0.651830598285109, 0.419091927419695,
        1.20868600421631, 0.387049350661405, 0.498361482019741, -0.0181098907988381,
        -1.60600085376757, 1.05019797569017, 0.477683673847205, 0.974151715301505,
        0.179010336207746, 0.239190692924513, -0.938831316889055, 0.0559620463603599,
        0.98505411012446, 1.14662077423341, 0.43800612403927, 0.430682606779034,
        0.389272550609032, -0.0913629791040046, -1.54077089232264, -0.481136182876391,
        -1.33508743019442, 0.623961719485822, 1.25651662413377, 0.694627897063936,
        1.72279001323325, 0.914657141344811, -1.03557729545544, -0.189302018195012,
        0.544883879169649, -0.0528866314210966, 1.0881576215757, -0.386953567686314,
        -0.715233431358608, 0.142255876143737, 0.0906998883407385, -0.583964406739944,
        1.33996906816035, -0.4078960415592, -0.350538762537026, -0.646752142538601,
        -0.0982523126724834, -0.665391780542421, -0.526340503378535,
        -0.674606559491139, 0.421699450719205, 0.369005359079488, -0.929264231418034,
        -0.31703538179523, -0.795303174053131, -0.0556350508822098, 0.39038112667931,
        1.60481091239699, -0.719304993913355, -0.402525268579182, 1.63242137281921,
        -0.568316823347491, 1.19954857474815, 0.381988752388686, 0.333155597375271,
        0.472001111175877, -1.61962242403564, 2.15290430198971, 1.32795981792943,
        0.0591424452969583, 0.146378878403549, -0.481255557928879, -0.929103027124259,
        0.470904562715436, 0.851425518302263, 1.14846687338018, -0.403755171177331,
        -0.491649705856078, 2.08814880318305, -0.119543077237744, -1.46393422115385,
        0.159698482301662, -0.278134960190864, 0.363963892162583, -0.127479123113297,
        0.0815179654989981)

set.seed(1)
a <- pbboot(v1, m.boot, R = 1000)
b <- pbboot(v1, m.boot, R = 1000, ncpus=4, parallel="multicore")

expect_equal(a$t0, mean(v1), tolerance=1e-5)
expect_equal(a$t0, b$t0, tolerance=1e-5)

expect_error(pbboot(v1, m.boot, R = 0)$t0)
expect_equal(dim(a$t), c(1000, 1))
